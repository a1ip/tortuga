om.ns_run("trtg.tbox.tortoise_vm",function(a){var b={move_:1},c={line_:1},d="round",e="butt",f=function(a){return a/180*Math.PI},g=function(a,b,c,e,f,g){this.dsTortoise=g,this.x=a,this.y=b,this.deg=0,this.isDrawing=!1,this.color=c,this.width=e||1,this.style_caps=f||d},h=function(a,b){this.trTortoise=a,this.x=a.x,this.y=a.y,this.color=a.color,this.width=a.width,this.style_caps=a.style_caps,this.moveOrLine=b};h.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.color==a.color&&this.width==a.width&&this.style_caps==a.style_caps&&this.trTortoise==a.trTortoise};var i=function(a,d){var e=a.points;if(0==e.length||d.moveOrLine==c)return void e.push(d);var f=e[e.length-1];return f.moveOrLine==b?(e.pop(),i(a,d)):f.equals(d)?void 0:void e.push(d)},j=function(a){var b=a.drawingSystem;a.tortoises.forEach(function(a){b.placeTortoise(a.dsTortoise,a.x,a.y,a.deg,a.isDrawing,a.color)})},k=function(a){var c=a.drawingSystem,d=!1;a.points.forEach(function(a){a.moveOrLine==b?(d?c.stroke():d=!0,c.beginPath(),c.setColor(a.color),c.setWidth(a.width),c.setCapsStyle(a.style_caps),c.moveTo(a.x,a.y)):c.lineTo(a.x,a.y)}),d&&c.stroke()},l=function(a,b,c,d,e,f,h){var i=a.drawingSystem.createTortoise(),j=new g(b,c,d,e,f,i);a.tortoises.push(j),h(j)},m=function(a){a.drawingSystem.clearCanvas()},n=function(a,d,e){e=e||0;var g=d(),j=g.isDrawing;j&&i(a,new h(g,b));var k=f(g.deg);g.x+=e*Math.cos(k),g.y+=e*Math.sin(k),j&&i(a,new h(g,c))},o=function(a,b){b().isDrawing=!0},p=function(a,b){b().isDrawing=!1},q=function(a,b,c){c=c||0,b().deg+=c},r=function(a,b,c){b().color=c},s=function(a,b,c){b().x=c},t=function(a,b,c){c(b().x)},u=function(a,b,c){b().y=c},v=function(a,b,c){c(b().y)},w=function(a,b,c){c(b().deg)},x=function(a,b,c){b().deg=c},y=function(a,b){b().style_caps=e},z=function(a,b){b().style_caps=d},A=function(a,b,c){b().width=c},B=function(a,b,c,d){var e=b();c=c||0;var g=f(e.deg),h=e.x+c*Math.cos(g),i=e.y+c*Math.sin(g);d(a.drawingSystem.getColorAt(h,i))},C=function(a,b){var c=b(),d=a.tortoises,e=d.indexOf(c);-1!=e&&(d.splice(e,1),a.drawingSystem.destroyTortoise(c.dsTortoise))},D=function(){},E=function(a,b,c){b(a),c(a)},F=function(a,b){b.forEach(function(b){b(a)})},G=function(a,b,c){for(var d=0;b>d;++d)c(a)},H=function(){var a=arguments[0],b=arguments,c=function(c){b[0]=c,a.apply(null,b),b[0]=a};return c.args=b,c},I=function(a,b){a.args[1].push(b)},J=function(a,b){var c=a.args[1].concat(b.args[1]);return H(F,c)},K=function(a){this.drawingSystem=a,this.tortoises=[]};K.prototype={constructor:K,run:function(a){var b=this;b.points=[];b.drawingSystem;a(b),k(b),j(b)}},K.commands={create:l,clearCanvas:m,go:n,tailDown:o,tailUp:p,rotate:q,setColor:r,setWidth:A,setX:s,getX:t,setY:u,getY:v,getAngle:w,setAngle:x,capsRound:z,capsSquare:y,kill:C,nil:D,pair:E,seq:F,repeat:G,getColorUnderTail:B},K.constructCommand=H,K.appendCommandToSeq=I,K.concatSeqs=J,a.TortoiseRunner=K}),om.ns_run("trtg.values",function(a){a.lessons={_1:{title:"Урок 1",tasks:[{title:"Углы",description:'Все лучи выходят из&nbsp;одной точки под одинаковыми углами друг к&nbsp;другу.<br> Длина каждого лучика равна&nbsp;40.<br> <br> Для справки:<ul> <li><a href="http://youtu.be/9hqxegcnNiw">Что такое углы и градусы?</a></li> <li><a href="http://youtu.be/nqPWQCl2ZBM">Как рисовать при помощи черепашки?</a></li> </ul> ',definition:function(){console.log("First lesson, House")},src:"lessons/tortuga-01-1-angles.png"},{title:"Многоугольники",description:"Длина стороны большинства многоугольников равна&nbsp;40. В&nbsp;двух случаях длина указана на&nbsp;рисунке и&nbsp;обозначена буквой&nbsp;L.<br> Во&nbsp;всех случаях кроме одного количество углов можно посчитать самостоятельно, а&nbsp;в&nbsp;особом случае количество углов указано на&nbsp;рисунке и&nbsp;обозначено за&nbsp;N.",definition:function(){console.log("First lesson, Village")},src:"lessons/tortuga-01-2-polygons.png"},{title:"Домик",description:"Все изображённые отрезки одинаковы и&nbsp;равны&nbsp;200.<br> Нарисуйте цветной домик поверх серого и&nbsp;на&nbsp;своё усмотрение  добавьте на&nbsp;картинку дополнительные элементы: окно, трубу, лавочку, дерево и&nbsp;т.&nbsp;п.",src:"lessons/tortuga-01-3-house.png"}],words:["word-1.1","word-1.2"]},_2:{title:"Урок 2",tasks:[{title:"Три дома",description:"Длины всех отрезков в&nbsp;больших домах равны&nbsp;200. Длины всех отрезков в&nbsp;маленьком домике равны&nbsp;100.",src:"lessons/tortuga-02-1-3houses.png"},{title:"Деревня",description:"В&nbsp;домах верхнего ряда длины всех отрезков равны&nbsp;40,<br> в&nbsp;домах среднего&nbsp;—&nbsp;60,<br>в&nbsp;домах нижнего&nbsp;—&nbsp;80.<br><br>Боковое расстояние между домами равно половине длины отрезка.",src:"lessons/tortuga-02-2-many_houses.png"},{title:"Город",description:"Каждый дом построен по следующим принципам:<br><br> &nbsp;&nbsp;- высота окна в полтора раза больше его ширины.<br> &nbsp;&nbsp;- расстояние между окнами как по горизонтали, так и по вертикали равно высоте окна.<br> &nbsp;&nbsp;- высота дома больше суммы высоты всех этажей на половину высоты окна.<br><br> Про каждый дом известна его ширина, она обозначена на рисунке буквой w. Зная ширину дома, можно найти ширину и высоту каждого окна. Зная высоту окна, можно найти высоту дома.<br><br> Дома на правом и левом рисунке одинаковы и одинаково расположены. Отличаются только окнами.",src:"lessons/tortuga-02-3-gorod.png"}],words:["word-1.1","word-2.1","word-2.2"]}}}),om.ns_run("trtg.values",function(a){a.site_footer_structure={columns:[["js/trtg/values/footer_authors.data.html"],["js/trtg/values/footer_lessons.data.html","js/trtg/values/footer_recepies.data.html"],["js/trtg/values/footer_project.data.html","js/trtg/values/footer_mirrors.data.html"],["js/trtg/values/footer_similar.data.html"]]}}),om.ns_run("trtg.lessons",function(a){var b=(om.ns_get("om.func.curry"),om.ns_get("om.text.htmlspecialchars"));a.LessonController=function(a,e,f,g){var h=this;g.$on("$locationChangeSuccess",function(){var a=e.get_lesson_data(),g=e.get_task_data();if(!a||!g)return h.has_lesson=!1,h.task_data=null,h.tasks_titles=[],!0;h.has_lesson=!0,h.task_data=g,h.task_num=e.get_task_num();var i=b(g.description);i=d(c(i)),h.task_description=f.trustAsHtml(i);var j=0;h.tasks=a.tasks.map(function(a){return{title:a.title,is_current:j==h.task_num,url:e.get_task_url(j++)}})})};var c=function(a){var b='<a href="$1">$2</a>',c="&lt;a href=",d="&quot;(.*?)&quot;",e="&#039;(.*?)&#039;",f="&gt;(.*?)&lt;/a&gt;",g=new RegExp(c+d+f,"gi"),h=new RegExp(c+e+f,"gi");return a.replace(g,b).replace(h,b)},d=function(a){var b=[["br","<br/>"],["br/","<br/>"],"p","b","i","u","ul","li","&nbsp;","&mdash;"],c="&lt;",d="&gt;";return replaces=[],b.forEach(function(a){"string"!=typeof a?replaces.push([c+a[0]+d,a[1]]):"&"===a.charAt(0)?replaces.push(["&amp;"+a.substring(1),a]):(replaces.push([c+a+d,"<"+a+">"]),replaces.push([c+"/"+a+d,"</"+a+">"]))}),replaces.forEach(function(b){a=a.replace(new RegExp(b[0],"gi"),b[1])}),a}}),om.ns_run("trtg.lessons",function(a){var b=(om.ns_get("om.func.curry"),"tasks");a.LessonService=function(a,b,c){this.location_service_=a,this.lessons_structure_=b,this.$location_=c},a.LessonService.prototype.get_lesson_data=function(){var a=this.lessons_structure_,b=this.location_service_.get_path_pairs_map().lessons,c=a[b];return c&&c.tasks?c:null},a.LessonService.prototype.get_task_num=function(){var a=this.get_lesson_data(),c=Number(this.location_service_.get_path_pairs_map()[b]);return c>=a.tasks.length?0:c},a.LessonService.prototype.get_task_url=function(a){a=void 0!==a?a:this.get_task_num();var c=this.location_service_,d=(this.$location_,c.get_path()),e=c.update_path_pair(d,b,a);return c.update_url(e)},a.LessonService.prototype.get_task_data=function(){var a=this.get_lesson_data();return a?a.tasks[this.get_task_num()]:null}}),om.ns_run("trtg.lessons",function(a){var b=3,c="001",d=function(a){return unescape(encodeURIComponent(a))},e=function(a){return decodeURIComponent(escape(a))},f=function(a){return btoa(RawDeflate.deflate(d(a)))},g=function(a){var b=f(JSON.stringify(a)),d=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1);return location.origin+d+"index.html?"+c+b},h=function(){return c},i=function(a){var c=a.indexOf("?"),d=a.substr(c+1+b);return d},j=function(a){return e(RawDeflate.inflate(atob(i(a))))},k=function(){return j(location.search)},l=function(){try{var a=k();return""!=a?JSON.parse(a):"indexpage"}catch(b){return null}};a.ParamsUtil={getLesson:l,getLessonLink:g,givCurrentVersion:h,getLessonTextFromUriValue:k,getLessonTextFromGetUriValue:j}}),function(){{var a=om.ns_get;a("om.func.curry")}angular.module("trtg.lessons.lessons_module",["trtg.site.site_module"]).constant("lessons_structure",a("trtg.values.lessons")).service("lesson_service",["location_service","lessons_structure","$location",a("trtg.lessons.LessonService")]).controller("LessonController",["location_service","lesson_service","$sce","$scope",a("trtg.lessons.LessonController")])}(),om.ns_run("trtg.lessons",function(a){var b=om.ns_get,c=b("trtg.lessons.ParamsUtil.givCurrentVersion"),d=b("trtg.lessons.ParamsUtil.getLesson"),e=b("om.text.htmlspecialchars"),f="tortuga-lessonsContainers-empty",g="tortuga-lessonsListContainer-list",h="tortuga-lessonsListContainer-header",i="tortuga-lessonsListContainer-item",j="tortuga-lessonsListContainer-itemSelected",k="tortuga-lessonsListContainer-item-number",l="tortuga-lessonsListContainer-item-text",m="tortuga-lessonsListContainer-item-textSelected",n=function(a,b){a&&a.classList.add(b)},o=function(a,b){a.classList.remove(b)},p=function(){var a=document.URL.indexOf("#");if(-1!=a){var b=document.URL.slice(a+1);return b}return""},q=function(){var a=document.URL.indexOf("?");if(-1!=a){var b=document.URL.slice(a+1,a+1+c().length);return b}return""},r=function(a){var b='<a href="$1">$2</a>',c="&lt;a href=",d="&quot;(.*?)&quot;",e="&#039;(.*?)&#039;",f="&gt;(.*?)&lt;/a&gt;",g=new RegExp(c+d+f,"gi"),h=new RegExp(c+e+f,"gi");return a.replace(g,b).replace(h,b)},s=function(a){return a.replace(/&lt;br&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>")},t=function(a,b,c,d,e,f,g,h){var i=e;h.setLessonsTitle(a.title),g.innerHTML=r(a.description),f.dispatch(a.src),void 0!==d&&(window.location.hash=d),i.itemText&&o(i.itemText,m),i.itemDiv&&o(i.itemDiv,j),i.itemText=b,i.itemDiv=c,n(b,m),n(c,j)},u=function(a,b,c,d,f,g,h){var j={src:e(b.src),title:e(b.title,!0),description:s(r(e(b.description,!0)))},m=d,o=document.createElement("DIV");n(o,k),o.innerHTML=g;var p=document.createElement("DIV");n(p,l),p.innerHTML=j.title;var q=document.createElement("LI");n(q,i);var u=function(){t(j,p,q,g,m,c,f,h)};return q.onclick=u,q.appendChild(o),q.appendChild(p),a.appendChild(q),{selectCurrent:u}},v=function(a,b,c,d){var e=document.createElement("UL");n(e,g);for(var f=a.length,h={},i=function(a,f){return u(e,a,b,h,c,f,d)},j=i(a[0],0),k=p(),l=1;f>l;++l){var m=i(a[l],l);k==l&&(j=m)}return j.selectCurrent(),e},w=function(a,b){this.tortugaEnv=a,this.title=b};w.prototype.setLessonsTitle=function(a){this.tortugaEnv.setLessonsTitle(a+" \\ "+this.title)};var x=function(a,b,c,d,e){b.appendChild(v(e.items,a,c,new w(d,e.title)))},y=function(a,b,c,d,e){for(var f=1;f<=b.children.length;f++){var g=b.children[f];b.removeChild(g)}x(a,b,c,d,e)},z=function(){var a=window.location.pathname;location=a};a.initLessons=function(a,b,e,g,i){var j=d();if(null==j||"indexpage"==j)return void(null!=i&&i.forEach(function(a){n(a,f)}));null!=i&&i.forEach(function(a){o(a,f)});var k=c();if(q()!=k&&(alert("Некорректная версия урока."),z()),"onhashchange"in window)window.onhashchange=function(){y(a,b,e,g,j)};else{var l=window.location.hash;window.setInterval(function(){window.location.hash!=l&&y(a,b,e,g,j)},100)}var m=document.createElement("DIV");n(m,h),b.appendChild(m),x(a,b,e,g,j)}}),om.ns_run("trtg.site",function(a){a.LocationService=function(a){this.$location_=a},a.LocationService.prototype={get_path_parts:function(){return c(this.$location_.path())},get_path_segments:function(){return d(this.get_path_parts())},get_path_pairs_map:function(){return f(this.get_path_segments())},get_path:function(){return this.$location_.path()},update_url:function(a){a="/"===a.charAt(0)?a:"/"+a;var b=this.$location_;return"#"+b.url().replace(b.path(),a)},update_path_pair:function(a,b,f){var h=c(a),i=d(h),j=e(i),k=j.filter(function(a){return a.key===b})[0];return k.value=f,g(j)}};var b=function(a){var b=a.split(";"),c=b.shift(),d={},e=0;return b.forEach(function(a){var b=/^(\w+)=(.*)$/.exec(a);b&&(d[b[1]]=b[2],++e)}),{segment:c,parameters:d,parameters_count:e}},c=function(a){var c=a.split("/");return c.filter(function(a){return!!a}).map(b)},d=function(a){return a.map(function(a){return a.segment})},e=function(a){var b=[],c=null;return a.forEach(function(a){null===c?c=a:(b.push({key:c,value:a}),c=null)}),b},f=function(a){var b={},c=null;return a.forEach(function(a){null===c?c=a:(b[c]=a,c=null)}),b},g=function(a){var b=[];return a.forEach(function(a){b.push(a.key),b.push(a.value)}),b.join("/")}}),function(){{var a=om.ns_get;a("om.func.curry")}angular.module("trtg.site.footer_module",[]).constant("log",console).constant("footer_structure",a("trtg.values.site_footer_structure")).controller("FooterController",["footer_structure",function(a){this.footer_structure=a}])}(),function(){{var a=om.ns_get;a("om.func.curry")}angular.module("trtg.site.site_module",[]).service("location_service",["$location",a("trtg.site.LocationService")])}(),om.ns_run("trtg.tbox.app_msg",function(a){function b(a,b){this.handlers_=[],this.service_=b,a.$on("$destroy",f.bind(this))}var c=function(a){var b=this;b.handlers_.push(a),b.service_.add_handler(a)},d=function(a){var b=this,c=b.handlers_.indexOf(a);c>=0&&b.handlers_.splice(c,1),b.service_.remove_handler(a)},e=function(){var a=this.service_;return a.dispatch.apply(a,arguments)},f=function(){var a=this;a.handlers_.forEach(d.bind(a))};b.prototype.add_handler=c,b.prototype.remove_handler=d,b.prototype.dispatch=e,a.DispatcherController=b}),om.ns_run("trtg.tbox.app_msg",function(a){function b(){this.handlers_=[]}var c=function(a){var b=this.handlers_;-1==b.indexOf(a)&&b.push(a)},d=function(a){var b=this.handlers_,c=b.indexOf(a);c>=0&&b.splice(c,1)},e=function(){var a=this,b=arguments,c=a.handlers_,d=function(c){return c.apply(a,b)};return 1==c.length?d(c[0]):void c.forEach(d)};b.prototype.add_handler=c,b.prototype.remove_handler=d,b.prototype.dispatch=e,a.DispatcherService=b}),om.ns_run("trtg.tbox.app_msg",function(a){function b(a){this.Block_=a;var b=this.blocks_=[],c=function(){var a=this,c=arguments,d=function(b){return a.apply(b,c)};return 1==b.length?d(b[0]):void b.forEach(d)},d=a.prototype;for(var e in d)this[e]=c.bind(d[e])}var c=function(){var a=this,b=Object.create(a.prototype);return a.apply(b,arguments),b},d=function(){var a=this,b=c.apply(a.Block_,arguments);return a.blocks_.push(b),b},e=function(a){var b=this.blocks_,c=b.indexOf(a);c>=0&&b.splice(c,1)};b.prototype.register_block=d,b.prototype.unregister_block=e,a.MethodsDispatcherService=b}),om.ns_run("trtg.tbox.app_msg",function(a){function b(a,b){for(var c in b)angular.isFunction(b[c])&&(a[c]=b[c].bind(b))}a.ServiceProxyController=b}),om.ns_run("trtg.tbox.app_msg",function(a){function b(a,b){var c=function(a,c){var d=c.text(),e=a[b],f=function(a){d+=a,c.text(d)};e.add_handler(f),c.on("$destroy",function(){e.remove_handler(f)})};return{restrict:"A",link:c,controller:a+" as "+b}}function c(a,b){var c=function(a,c){c.on("keydown",function(d){13==d.keyCode&&(a[b].dispatch(c.val()),c.val(""),d.preventDefault())})};return{restrict:"A",link:c,controller:a+" as "+b}}a.ConsoleOutDirective=b,a.ConsoleInDirective=c}),om.ns_run("trtg.tbox.tblocks",function(a){var b=function(a){var b=a.getContext("2d");return b.lineJoin="round",b.lineCap="round",b},c=function(a,b,c){return{x:b,y:a.canvas.height-c}},d=function(a,b,c){return{x:b,y:a.canvas.height-c}},e=function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height)},f=function(a,b){a.strokeStyle=b},g=function(a,b){a.lineWidth=b},h=function(a,b){a.lineCap=b},i=function(a,b,c,d){c=a.canvas.height-c;var e=a.getImageData(b,c,1,1).data,f=e[3]?{red:e[0],green:e[1],blue:e[2]}:{red:255,green:255,blue:255};return d&&(f.alpha=e[3]),f},j=function(a){var b=document.createElement("DIV");b.className="om-tortoise-div",a.appendChild(b);var c=document.createElement("DIV");c.className="om-tortoise-pointer",b.appendChild(c);var d=document.createElement("DIV");d.className="om-tortoise-color",b.appendChild(d);var e=document.createElement("DIV");return e.className="om-tortoise-image",b.appendChild(e),{main:b,pointer:c,color:d}},k=function(a){return 90-a},l=function(a){return a/180*Math.PI},m=function(a){var b=a.tortoiseCounter;return a.tortoises[b]=j(a.tortoiseContainer),a.tortoiseCounter++,b},n=function(a,b){var c=a.tortoises[b];delete a.tortoises[b],a.tortoiseContainer.removeChild(c.main)},o=function(a,b,c,d,e,f,g){var h=a.tortoises[b],i=h.main,j=l(e),m=k(e),n=i.offsetWidth*(Math.cos(j)-Math.sin(j)/2),o=i.offsetWidth*(Math.cos(j)/2+Math.sin(j)-1);i.style.left=c+n+"px",i.style.bottom=d+o+"px";var p="rotate("+m+"deg)",q="0% 0%";i.style.webkitTransform=p,i.style.webkitTransformOrigin=q,i.style.MozTransform=p,i.style.MozTransformOrigin=q,i.style.OTransform=p,i.style.OTransformOrigin=q,i.style.msTransform=p,i.style.msTransformOrigin=q,h.pointer.style.background=f?g:"none",h.color.style["border-color"]=g,h.color.style.borderColor=g},p=function(a,c){var d=b(a);this.ctx=d,this.ctx.setTransform(1,0,0,-1,0,a.height),this.tortoiseContainer=c,this.tortoises={},this.tortoiseCounter=0};p.prototype={setColor:function(a){f(this.ctx,a)},getColorAt:function(a,b){return i(this.ctx,a,b,!1)},getColorWithAlphaAt:function(a,b){return i(this.ctx,a,b,!0)},setWidth:function(a){g(this.ctx,a)},moveTo:function(a,b){this.ctx.moveTo(a,b)},lineTo:function(a,b){this.ctx.lineTo(a,b)},beginPath:function(){this.ctx.beginPath()},stroke:function(){this.ctx.stroke()},clearCanvas:function(){e(this.ctx)},setCapsStyle:function(a){h(this.ctx,a)},getCanvas:function(){return this.ctx.canvas},convertCoordsTortugaToCanvas:function(a,b){return c(this.ctx,a,b)},convertCoordsCanvasToTortuga:function(a,b){return d(this.ctx,a,b)},createTortoise:function(){return m(this)},placeTortoise:function(a,b,c,d,e,f){o(this,a,b,c,d,e,f)},destroyTortoise:function(a){n(this,a)}},a.TortoiseCanvasBlock=p}),om.ns_run("trtg.tbox.tblocks",function(a){a.TortoiseCanvasController=function(a,b,c,d,e){var f=this;f.tortuga_service=b,f.mouse_service=c;var g=function(){var a=e.get_task_data();return a?a.src:""};a.$watch(g,function(a){f.background_url=a}),d.add_handler(function(b){f.background_url=b,a.$apply()})}}),om.ns_run("trtg.tbox.tblocks",function(a){a.TortoiseCanvasDirective=function(a,b){var c=function(a,c){var d,f,g=(om.ns_get("Array.prototype.slice"),a[b]);!function(){var a=c.find("div");f=a[0],a.css("height",f.offsetWidth/2+"px");var b=c.find("canvas");d=b[0],b.attr("width",d.offsetWidth).attr("height",d.offsetHeight),g.mouse_service.subscribe_on_canvas(d),e=c}();var h=g.tortuga_service.register_block(d,f);c.on("$destroy",function(){g.tortuga_service.unregister_block(h),g.mouse_service.unsubscribe_from_canvas(d)})};return{restrict:"E",link:c,scope:{},controller:a+" as "+b,template:'<div class="tortuga-canvasContainer"><div class="tortuga-canvasContainer-bg" ng-attr-style="background-image:url({{'+b+'.background_url}})"></div><canvas class="tortuga-canvasContainer-canvas"></canvas></div>'}}}),om.ns_run("trtg.tbox.tortoise_vm",function(a){var b=om.ns_get("trtg.tbox.tortoise_vm.TortoiseRunner"),c=function(a){return b.constructCommand.apply(b,a)},d=function(){return c([b.commands.seq,[]])},e=function(a,c){b.appendCommandToSeq(a,c)},f=function(a,c){return b.concatSeqs(a,c)},g=function(a,d){return c([b.commands.repeat,a,d])},h=function(a,b){this.node=a,b[0]=null,this.params=b};h.prototype.process=function(){this.node.process.apply(this.node,arguments)};var i=function(a){this.command=a};i.prototype.process=function(a,b){var d=b.params,f=d[0];d[0]=this.command;var g=c(d);d[0]=f,e(a.currentCommand,g)};var j=function(a){this.command=a};j.prototype.process=function(a,b){var d=b.params,f=d[0],g=d[1];d[0]=this.command,d[1]=function(){return g.value};var h=c(d);d[0]=f,d[1]=g,e(a.currentCommand,h)};var k=function(a){this.command=a};k.prototype.process=function(a,b){for(var d=new G,f=[this.command],g=b.params,h=g.length,i=1;h>i;++i)f.push(g[i]);f.push(function(a){d.value=a});var j=c(f);e(a.currentCommand,j),a.result=d};var l=function(a){this.command=a};l.prototype.process=function(a,b){var d=new G,f=[this.command],g=b.params,h=g[1];f.push(function(){return h.value});for(var i=g.length,j=2;i>j;++j)f.push(g[j]);f.push(function(a){d.value=a});var k=c(f);e(a.currentCommand,k),a.result=d};var m={process:function(a,b){a.commandsStack.push(a.currentCommand),a.nodesStack.push(b),a.currentCommand=d()}},n={process:function(a,b){a.commandsStack.push(a.currentCommand),a.nodesStack.push(b),a.currentCommand=d()}},o={process:function(a){var b=a.nodesStack.pop(),c=a.currentCommand;switch(b.node){case n:var h=g(b.params[1],c);c=d(),e(c,h);break;case m:}var i=a.commandsStack.pop();a.currentCommand=f(i,c)}},p=new k(b.commands.create),q=new l(b.commands.getColorUnderTail),r=new l(b.commands.getX),s=new l(b.commands.getY),t=new l(b.commands.getAngle),u=new j(b.commands.go),v=new j(b.commands.rotate),w=new j(b.commands.tailUp),x=new j(b.commands.tailDown),y=new j(b.commands.setWidth),z=new j(b.commands.setColor),A=new j(b.commands.setX),B=new j(b.commands.setY),C=new j(b.commands.setAngle),D=new j(b.commands.capsRound),E=new j(b.commands.capsSquare),F=new i(b.commands.clearCanvas),G=function(a){this.value=a},H=function(a){this.tortoiseRunner=a,this.nodesStack=[],this.commandsStack=[],this.currentCommand=d()};H.prototype.parseNode=function(a){this.result=null;var b=new h(a,arguments);return b.process(this,b),0==this.nodesStack.length&&(this.tortoiseRunner.run(this.currentCommand),this.currentCommand=d()),this.result},H.prototype.nodes={begin:m,repeat:n,end:o,create:p,go:u,setX:A,getX:r,setY:B,getY:s,rotate:v,tailUp:w,tailDown:x,setWidth:y,setColor:z,capsRound:D,capsSquare:E,clearCanvas:F,getAngle:t,setAngle:C,getColorUnderTail:q},a.JsConverter=H}),om.ns_run("trtg.tbox.tortoise_vm",function(a){var b=om.ns_get("om.func.curry"),c=["click","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel"],d=function(a,b,c){var d=b.convertCoordsCanvasToTortuga(c.layerX,c.layerY),e={tortugaX:d.x,tortugaY:d.y,originalEvent:c},f="on"+c.type;"function"==typeof a[f]&&a[f](e)};a.MouseManager=function(a){var e=om.ns("Tortuga.Events");c.forEach(function(a){e["on"+a]=null});var f=b(d,e,a);this.subscribe_on_canvas=function(a){c.forEach(function(b){a.addEventListener(b,f)})},this.unsubscribe_from_canvas=function(a){c.forEach(function(b){a.removeEventListener(b,f)})}}}),om.ns_run("trtg.tbox.tortoise_vm",function(a){var b=(om.ns_get("trtg.tbox.tortoise_vm.TortoiseRunner"),Array.prototype.slice),c=function(a,c){var d=b.apply(c);return d.unshift(a),d},d=function(a,b,c,d,e,f){return a.parseNode(a.nodes.create,b,c,d,e,f)},e=function(a,b,c){return a.parseNode(a.nodes.getColorUnderTail,b,c).value},f=function(a,b){return a.parseNode(a.nodes.getX,b).value},g=function(a,b){return a.parseNode(a.nodes.getY,b).value},h=function(a,b){return{x:a.parseNode(a.nodes.getX,b).value,y:a.parseNode(a.nodes.getY,b).value}},i=function(a,b,c,d){"number"==typeof c?(a.parseNode(a.nodes.setX,b,c),a.parseNode(a.nodes.setY,b,d)):(a.parseNode(a.nodes.setX,b,c.x),a.parseNode(a.nodes.setY,b,c.y))},j=function(a,b){return a.parseNode(a.nodes.getAngle,b).value},k=function(a,b,c){for(var d in a)b[d]=c(a[d])},l=function(a,b){return function(){var d=c(this.jsTortoise,arguments);return d=c(a,d),b.parseNode.apply(b,d),this}},m=function(a,b){return function(){var d=c(a,arguments);return b.parseNode.apply(b,d)}},n=function(a){return{go:a.nodes.go,rotate:a.nodes.rotate,tailUp:a.nodes.tailUp,tailDown:a.nodes.tailDown,setColor:a.nodes.setColor,setWidth:a.nodes.setWidth,capsRound:a.nodes.capsRound,capsSquare:a.nodes.capsSquare,setX:a.nodes.setX,getX:a.nodes.getX,setY:a.nodes.setY,getY:a.nodes.getY,getAngle:a.nodes.getAngle,setAngle:a.nodes.setAngle}};a.TortoiseGlobals=function(a){var b=function(b,c,e,f,g){b=void 0===b?0:b,c=void 0===c?0:c,e=e||"#0a0",f=f||1,g=g||"round",this.jsTortoise=d(a,b,c,e,f,g)};k(n(a),b.prototype,function(b){return l(b,a)}),b.prototype.getColorUnderTail=function(b){return e(a,this.jsTortoise,b)},b.prototype.getX=function(){return f(a,this.jsTortoise)},b.prototype.getY=function(){return g(a,this.jsTortoise)},b.prototype.getCoords=function(){return h(a,this.jsTortoise)},b.prototype.setCoords=function(b,c){return i(a,this.jsTortoise,b,c)},b.prototype.getAngle=function(){return j(a,this.jsTortoise)};var c=b.prototype;c.fw=c.go,c.forward=c.go,c.lt=c.rotate,c.rt=function(a){return this.rotate(a?-a:0)},c.up=c.tailUp,c.dw=c.tailDown,clearCanvas=m(a.nodes.clearCanvas,a),begin=m(a.nodes.begin,a),repeat=m(a.nodes.repeat,a),end=m(a.nodes.end,a),createTortoise=function(c,d,e,f,g){return new b(c,d,e,f,g,a)}}}),function(){var a=om.ns_get,b=a("om.func.curry"),c=function(b){return a("trtg.tbox.tortoise_vm."+b)},d=function(b){return a("trtg.tbox."+b)},e=function(b){return a("trtg.tbox.app_msg."+b)};angular.module("t_box_module.TBoxTortoiseCanvas",["trtg.lessons.lessons_module"]).value("TBoxTortoiseCanvasBlock",d("tblocks.TortoiseCanvasBlock")).service("tbox_tortoise_canvas_service",["TBoxTortoiseCanvasBlock",e("MethodsDispatcherService")]).service("tbox_tortoisevm_tortoise_runner",["tbox_tortoise_canvas_service",c("TortoiseRunner")]).service("tbox_tortoisevm_js_converter",["tbox_tortoisevm_tortoise_runner",c("JsConverter")]).service("tbox_tortoisevm_tortoise_globals",["tbox_tortoisevm_js_converter",c("TortoiseGlobals")]).service("tbox_tortoisevm_mouse_manager",["tbox_tortoise_canvas_service",c("MouseManager")]).service("tbox_tortoise_canvas_bg_dispatcher",e("DispatcherService")).controller("TBoxTortoiseCanvasController",["$scope","tbox_tortoise_canvas_service","tbox_tortoisevm_mouse_manager","tbox_tortoise_canvas_bg_dispatcher","lesson_service",d("tblocks.TortoiseCanvasController")]).directive("tboxTortoiseCanvas",b(d("tblocks.TortoiseCanvasDirective"),"TBoxTortoiseCanvasController")),angular.module("t_box_module",["t_box_module.TBoxTortoiseCanvas"]).run(["$injector",function(a){a.get("tbox_tortoisevm_tortoise_globals"),a.get("tbox_tortoisevm_mouse_manager")}]),angular.bootstrap(document.getElementById("t_box_module"),["t_box_module"])}(),function(){angular.module("index_app",["trtg.site.footer_module","trtg.lessons.lessons_module","t_box_module"])}(),om.ns("Tortuga"),Tortuga.Agent,function(){var a=function(a,b){for(var c=a.length,d=0;c>d;++d)if(b(a[d]))return!0;return!1},b=function(a){return-1!=navigator.userAgent.indexOf(a)},c=function(){return b("Mac")},d=function(){return b("Chrome")},e=function(){return b("Firefox")},f=function(){return b("Safari")},g=function(){return b("Opera")},h=function(){return!b("MSIE 8")&&(a([9,10],function(a){return b("MSIE "+a)})||b("Trident"))},i=function(a,b){var c=b?"Консоль открывается нажатием клавиши":"Консоль открывается сочетанием клавиш";return a&&c+": <b>"+a+".</b>"},j=function(a){return i(a)+" Чтобы получить возможность открывать консоль, нужно включить <a href='http://developer.apple.com/library/safari/#documentation/appleapplications/Conceptual/Safari_Developer_Guide/1Introduction/Introduction.html'>инструменты разработки</a> в&nbsp;настройках браузера."},k=function(){return"Страница предназначена для работы только в&nbsp;<a href='https://www.google.com/intl/en/chrome/'>Хроме</a> и&nbsp;<a href='http://ru.wikipedia.org/wiki/Chromium#.D0.9F.D1.80.D0.B8.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F.2C_.D0.BE.D1.81.D0.BD.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D1.8B.D0.B5_.D0.BD.D0.B0_Chromium'>других</a> хромоподобных <a href='http://browser.yandex.ru'>браузерах</a>."},l=function(){return"<div class='top-warning'>"+k()+"</div>"},m=function(a,b){return"<div class='top-notification'>"+a(b)+"</div>"},n=function(a){return m(j,a)},o=function(a){return m(i,a)},p={hotkeys:[null,null],helpTextFun:k,topTextFun:l,showTop:!0},q={hotkeys:["Ctrl + Shift + J","⌥⌘J"],helpTextFun:i,topTextFun:o,showTop:!1},r={hotkeys:["Ctrl + Shift + K","⌥⌘K"],helpTextFun:i,topTextFun:o,showTop:!1},s={hotkeys:["Ctrl + Shift + C","⌥⌘C"],helpTextFun:j,topTextFun:n,showTop:!0},t={hotkeys:["Ctrl + Shift + I","⌥⌘I"],helpTextFun:i,topTextFun:o,showTop:!1},u={hotkeys:["F12","F12"],hotkeySingle:!0,helpTextFun:i,topTextFun:o,showTop:!1},v=0,w=1,x=d()?q:e()?r:f()?s:g()?t:h()?u:p,y=c()?w:v,z=x.hotkeys[y],A=x.hotkeySingle;Tortuga.Agent={hotkey:z,topText:x.topTextFun(z),helpText:x.helpTextFun(z,A),showTop:x.showTop}}(),om.ns("Tortuga"),Tortuga.initFiles=function(a,b,c,d){var e=function(a,b){for(var c=a.length,d=0;c>d;++d)b(a[d])},f=function(a){console.log(a),c();var b=document.createElement("script");b.innerHTML=a;var e=document.getElementsByTagName("head")[0];e.appendChild(b),d()},g=function(a){var b=new FileReader;b.onload=function(a){f(a.target.result)},b.readAsText(a)},h=function(a){e(a.target.files,g),a.target.value=""},i=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},j=function(a){i(a),b.classList.add("tortuga-canvasContainer-dragging")},k=function(){b.classList.remove("tortuga-canvasContainer-dragging")},l=function(a){if(b.classList.remove("tortuga-canvasContainer-dragging"),a.dataTransfer.files){for(var c=a.dataTransfer.files,d=0;d<c.length;d++)g(c[d]);i(a)}if(a.dataTransfer.getData("Text")){var e=a.dataTransfer.getData("Text");f(e),i(a)}return!1};a.addEventListener("change",h,!1),b.addEventListener("dragleave",k,!1),b.addEventListener("dragover",j,!1),b.addEventListener("drop",l,!1)},om.ns("Tortuga"),Tortuga.initHelp,function(){var a="sideHelp-shown",b="pointer",c=function(){return!1},d=function(a,b){a.classList.add(b)},e=function(a,b){a.classList.remove(b)},f=function(a,e){return function(f){f.onclick=function(){a(e)},f.onmousedown=c,d(f,b)}},g={};g.showHelp=function(b){b.helpDivs.forEach(function(b){d(b,a)}),b.helpButtons.forEach(f(g.hideHelp,b))},g.hideHelp=function(b){b.helpDivs.forEach(function(b){e(b,a)}),b.helpButtons.forEach(f(g.showHelp,b))},Tortuga.initHelp=function(a,b){g.hideHelp({helpButtons:a,helpDivs:b})}}(),om.ns_run("Tortuga",function(a){var b=function(a,b){a.classList.add(b)},c=function(){};c.prototype.setLessonsTitle=function(a){document.title=a+" \\ Tortuga"};var d=function(a){b(a,"tortuga-filesArea");var c=document.createElement("INPUT");return b(c,"tortuga-filesArea-button"),c.type="file",c.multiple=!0,a.appendChild(c),{filesArea:a,button:c}};a.initApp=function(a,b,e,f){var g=d(e),h=angular.element(document.getElementById("t_box_module")).injector().get("tbox_tortoise_canvas_bg_dispatcher"),i=function(){};Tortuga.initFiles(g.button,f,i,i),trtg.lessons.initLessons(h,void 0,a,new c,b)}});